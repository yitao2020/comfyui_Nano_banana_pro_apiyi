# ComfyUI NanoBanana Pro 图像生成节点

这是一个用于 ComfyUI 的自定义节点，集成了 NanoBanana Pro (Gemini 3 Pro Image) API，支持文本生图和图生图功能。

## 功能特点

- ✅ 支持文本提示词生成图像
- ✅ 支持输入参考图像（可选）
- ✅ 自定义宽高比（10种比例可选）
- ✅ 自定义分辨率（1K/2K/4K）
- ✅ API密钥自动保存
- ✅ 详细的日志输出
- ✅ 智能超时控制

## 安装

1. 将此文件夹放置在 ComfyUI 的 `custom_nodes` 目录下
2. 安装依赖：
```bash
pip install -r requirements.txt
```
3. 重启 ComfyUI

## 使用方法

### 基本使用

1. 在 ComfyUI 中找到 `NanoBanana Pro` 分类
2. 添加 `NanoBanana Pro Image Generator` 节点
3. 输入你的 API Key（格式：`sk-your-api-key`）
4. 输入提示词
5. 选择宽高比和分辨率
6. 运行工作流

### 参数说明

**必需参数：**
- `api_key`: 你的 NanoBanana Pro API 密钥
- `prompt`: 图像描述提示词（支持中文和英文）
- `aspect_ratio`: 图像宽高比
  - 1:1（方形）
  - 16:9（横屏）
  - 9:16（竖屏）
  - 4:3, 3:4, 3:2, 2:3, 21:9, 5:4, 4:5
- `resolution`: 图像分辨率
  - 1K（快速生成，约180秒超时）
  - 2K（推荐，约300秒超时）
  - 4K（高清，约360秒超时）

**可选参数：**
- `image`: 参考图像输入（可选）

### 输出

- `image`: 生成的图像（IMAGE类型）
- `info`: 生成信息和日志（STRING类型）

## API 密钥

首次使用时需要输入 API 密钥，密钥会自动保存到节点目录的 `api_key.txt` 文件中，下次使用时无需重复输入。

如需更换密钥，直接在节点中输入新的密钥即可自动覆盖。

## 注意事项

1. 生成时间取决于所选分辨率：
   - 1K: 约10-30秒
   - 2K: 约20-60秒
   - 4K: 约30-90秒

2. 如果遇到超时错误，建议：
   - 使用更低的分辨率
   - 简化提示词
   - 检查网络连接

3. API 调用需要有效的网络连接和 API 配额

## 故障排除

**问题：节点无法加载**
- 确保已安装所有依赖包
- 检查 Python 版本（建议 3.10+）
- 重启 ComfyUI

**问题：API 请求失败**
- 检查 API 密钥是否正确
- 确认网络连接正常
- 查看节点输出的详细错误信息

**问题：生成的图像是空白的**
- 检查 API 响应日志
- 确认 API 配额是否充足
- 尝试简化提示词

## 技术支持

如有问题或建议，请查看节点输出的详细日志信息。

## 许可证

MIT License
